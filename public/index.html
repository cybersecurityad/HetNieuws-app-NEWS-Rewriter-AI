

<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes, user-scalable=yes">
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://stackpath.bootstrapcdn.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://www.gstatic.com">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="/hetnieuws-app-logo.png" as="image" type="image/webp">
    
    <!-- Styles and Fonts with display swap for better performance -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <link rel="icon" href="https://hetnieuws.app/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/media/image/apple-touch-icon.png">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'">
    
    <!-- Primary Meta Tags -->
    <title>HetNieuws.app - Nederlands Nieuws, Actuele Berichten uit de Wereld</title>
    <meta name="title" content="HetNieuws.app - Nieuws, Actuele Berichten uit Nederland en de Wereld">
    <meta name="description" content="Blijf op de hoogte van het laatste nieuws uit Nederland en de wereld, met globale, actuele, betrouwbare en onpartijdige berichtgeving op HetNieuws.app. Dagelijks vernieuwd met binnenlands nieuws, politiek, economie, sport en meer.">
    <meta name="keywords" content="nieuws nederland, actueel nieuws, laatste berichten, nederlands nieuws, dagelijks nieuws, betrouwbare berichtgeving, binnenlands nieuws, politiek nieuws, economisch nieuws, sport nieuws">
    <meta name="author" content="HetNieuws.app">
    <meta name="robots" content="index, follow, max-image-preview:large">
    <meta name="language" content="Dutch">
    <link rel="canonical" href="https://hetnieuws.app/">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://hetnieuws.app">
    <meta property="og:title" content="HetNieuws.app - Nederlands Nieuws, Actuele Berichten uit Nederland">
    <meta property="og:description" content="Blijf op de hoogte van het laatste nieuws uit Nederland met actuele, betrouwbare en onpartijdige berichtgeving op HetNieuws.app. Dagelijks vernieuwd met binnenlands nieuws, politiek, economie, sport en meer.">
    <meta property="og:image" content="https://hetnieuws.app/hetnieuws-app-logo.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="HetNieuws.app">
    <meta property="og:locale" content="nl_NL">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://hetnieuws.app">
    <meta name="twitter:title" content="HetNieuws.app - Nederlands Nieuws, Actuele Berichten uit Nederland en de Wereld">
    <meta name="twitter:description" content="Blijf op de hoogte van het laatste nieuws uit Nederland met actuele, betrouwbare en onpartijdige berichtgeving op HetNieuws.app. Dagelijks vernieuwd met buitenlandse nieuwtjes, binnenlands nieuws, politiek, economie, sport en meer.">
    <meta property="twitter:image" content="https://hetnieuws.app/hetnieuws-app-logo.png">
    
    <!-- Structured Data for Organization -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "NewsMediaOrganization",
        "name": "HetNieuws.app",
        "url": "https://hetnieuws.app",
        "logo": {
            "@type": "ImageObject",
            "url": "https://hetnieuws.app/hetnieuws-app-logo.png",
            "width": 600,
            "height": 60
        },
        "sameAs": [
            "https://www.facebook.com/hetnieuws.app",
            "https://twitter.com/hetnieuwsapp",
            "https://www.instagram.com/hetnieuws.app",
            "https://www.linkedin.com/company/hetnieuws-app"
        ],
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://hetnieuws.app/search?query={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    
    <!-- Structured Data for WebSite -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "HetNieuws.app",
        "url": "https://hetnieuws.app",
        "description": "Blijf op de hoogte van het laatste nieuws uit Nederland en de Wereld met globale, actuele, betrouwbare en onpartijdige berichtgeving op HetNieuws.app.",
        "publisher": {
            "@type": "Organization",
            "name": "HetNieuws.app",
            "logo": {
                "@type": "ImageObject",
                "url": "https://hetnieuws.app/hetnieuws-app-logo.png"
            }
        },
        "inLanguage": "nl-NL",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://hetnieuws.app/search?query={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    
    <!-- Breadcrumbs structured data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [{
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://hetnieuws.app/"
        }]
    }
    </script>
    
    <style>
    
    /* Base Styles */
    :root {
        --primary-color: #000080;
        --primary-color-dark: #000066;
        --primary-color-light: #3333cc;
        --secondary-color: #f4f4f9;
        --text-color: #333;
        --text-color-light: #666;
        --text-color-dark: #000;
        --white: #fff;
        --gray-light: #f0f0f0;
        --gray-medium: #ddd;
        --border-radius: 10px;
        --box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        --box-shadow-hover: 0 4px 8px rgba(0,0,0,0.15);
        --transition-fast: 0.2s;
        --transition-medium: 0.3s;
        --font-family: 'Poppins', sans-serif;
    }
    
    *, *::before, *::after {
        box-sizing: border-box;
    }
    
    html {
        font-size: 62.5%; /* 10px = 1rem */
        scroll-behavior: smooth;
    }
    
    body {
        font-family: var(--font-family);
        font-size: 1.6rem;
        margin: 0;
        padding: 0;
        background-color: var(--secondary-color);
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        color: var(--text-color);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
    
    img {
        max-width: 100%;
        height: auto;
        display: block;
    }
    
    a {
        color: var(--primary-color);
        text-decoration: none;
        transition: color var(--transition-fast);
    }
    
    a:hover {
        color: var(--primary-color-light);
    }
    
    button, input, select, textarea {
        font-family: inherit;
        font-size: inherit;
        line-height: inherit;
    }
    h1 {
  color: red !important;
}
    /* Skip to content link for accessibility */
    .skip-to-content {
        position: absolute;
        left: -9999px;
        top: auto;
        width: 1px;
        height: 1px;
        overflow: hidden;
    }
    
    .skip-to-content:focus {
        position: fixed;
        left: 0;
        top: 0;
        width: auto;
        height: auto;
        padding: 1rem;
        background: var(--primary-color);
        color: var(--white);
        z-index: 9999;
        overflow: auto;
    }
    
    /* Header Styles */
    .site-header {
        background: var(--primary-color);
        padding: 1rem;
        color: var(--white);
        box-shadow: var(--box-shadow);
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        z-index: 1001;
        position: relative;
    }
    
    .logo-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex: 1;
    }
    
    .logo-container > div:first-child {
        display: flex;
        align-items: center;
    }
    
    .logo-container img {
        width: 40px;
        height: auto;
        margin-right: 1rem;
    }
    
    .logo-container a {
        color: var(--white);
        text-decoration: none;
        font-size: 1.6rem;
        font-weight: 600;
    }
    
    .nav-links {
        display: flex;
        gap: 1.5rem;
    }
    
    .nav-links a {
        color: var(--white);
        font-size: 1.4rem;
        text-decoration: none;
        padding: 0.4rem 0.8rem;
        border-radius: 0.4rem;
        transition: background-color var(--transition-medium);
        font-weight: 500;
    }
    
    .nav-links a:hover, .nav-links a:focus {
        background-color: rgba(255, 255, 255, 0.1);
        outline: none;
    }
    
    .nav-links a:active {
        background-color: rgba(255, 255, 255, 0.2);
    }
    
    .nav-links a i {
        margin-right: 0.5rem;
    }
    
    /* Mobile menu */
    .mobile-menu-toggle {
        display: none;
        background: none;
        border: none;
        color: var(--white);
        font-size: 1.8rem;
        cursor: pointer;
        padding: 0.5rem;
    }
    
    .mobile-menu-toggle:focus {
        outline: 2px solid rgba(255, 255, 255, 0.5);
        border-radius: 0.4rem;
    }
    
    /* Main Content Layout */
    .main-container {
        max-width: 1200px;
        margin: 0 auto;
        width: 100%;
        display: flex;
        gap: 3rem;
        padding: 2rem;
        flex: 1;
    }
    
    .content-area {
        flex: 3;
    }
    
    .content-area h1 {
        color: var(--primary-color);
        font-size: 3.2rem;
        font-weight: 700;
        margin-bottom: 1rem;
        line-height: 1.2;
    }
    
    .content-area h2 {
        color: var(--text-color);
        font-size: 2.4rem;
        font-weight: 500;
        margin-bottom: 3rem;
        line-height: 1.3;
    }
    
    /* Category Filters */
    .category-filters {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .category-filter {
        padding: 0.8rem 1.5rem;
        background-color: var(--gray-light);
        border-radius: 2rem;
        font-size: 1.4rem;
        cursor: pointer;
        transition: all var(--transition-fast);
        user-select: none;
        border: none;
    }
    
    .category-filter.active {
        background-color: var(--primary-color);
        color: var(--white);
    }
    
    .category-filter:hover, .category-filter:focus {
        background-color: var(--gray-medium);
        outline: none;
    }
    
    .category-filter.active:hover, .category-filter.active:focus {
        background-color: var(--primary-color-dark);
    }
    .main-title {
  color: red !important;
}
    
    /* Article Styles */
    .article {
        background: var(--white);
        border-radius: var(--border-radius);
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: var(--box-shadow);
        transition: transform var(--transition-fast), box-shadow var(--transition-fast);
        position: relative;
    }
    
    .article:hover, .article:focus-within {
        transform: translateY(-3px);
        box-shadow: var(--box-shadow-hover);
    }
    
    .article-image-container {
        width: 100%;
        max-width: 600px;
        margin: 0 auto 1.5rem;
        text-align: center;
        overflow: hidden;
        border-radius: 0.8rem;
    }
    
    .article-image {
        width: 100%;
        max-height: 400px;
        object-fit: cover;
        border-radius: 0.8rem;
        transition: transform var(--transition-medium);
    }
    
    .article:hover .article-image {
        transform: scale(1.03);
    }
    
    .article h2 {
        color: var(--primary-color);
        font-size: 2.3rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        line-height: 1.3;
    }
    
    .article-title-link {
        color: var(--primary-color);
        text-decoration: none;
        transition: color var(--transition-fast);
        display: inline-block;
    }
    
    .article-title-link:hover, .article-title-link:focus {
        color: var(--primary-color-light);
        text-decoration: underline;
        outline: none;
    }
    
    .article h3 {
        color: var(--text-color);
        font-size: 1.8rem;
        font-weight: 500;
        margin-bottom: 1.5rem;
        line-height: 1.4;
    }
    
    .article p {
        font-size: 1.6rem;
        line-height: 1.6;
        color: var(--text-color-light);
        margin-bottom: 1.5rem;
    }
    
    .article .read-more {
        display: inline-block;
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
        margin-top: 1rem;
        padding: 0.8rem 1.5rem;
        background-color: var(--gray-light);
        border-radius: 0.4rem;
        transition: all var(--transition-fast);
    }
    
    .article .read-more:hover, .article .read-more:focus {
        background-color: var(--primary-color);
        color: var(--white);
        outline: none;
    }
    
    .article-date {
        color: var(--text-color-light);
        font-size: 1.4rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
    }
    
    .article-date i {
        margin-right: 0.5rem;
    }
    
    .article-categories {
        display: flex;
        flex-wrap: wrap;
        gap: 0.8rem;
        margin-bottom: 1rem;
    }
    
    .article-category {
        background-color: var(--primary-color);
        color: var(--white);
        padding: 0.4rem 1rem;
        border-radius: 1.5rem;
        font-size: 1.2rem;
        font-weight: 500;
        cursor: pointer;
        transition: background-color var(--transition-fast);
    }
    
    .article-category:hover, .article-category:focus {
        background-color: var(--primary-color-dark);
        outline: none;
    }
    
    .article-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.6rem;
        margin-top: 1.5rem;
    }
    
    .article-tag {
        background-color: var(--gray-light);
        color: var(--text-color);
        padding: 0.3rem 0.8rem;
        border-radius: 1.2rem;
        font-size: 1.1rem;
        cursor: pointer;
        transition: background-color var(--transition-fast);
    }
    
    .article-tag:hover, .article-tag:focus {
        background-color: var(--gray-medium);
        outline: none;
    }
    
    .featured-article {
        border: 2px solid var(--primary-color);
        position: relative;
        padding-top: 3.5rem;
    }
    .dark-mode-toggle {
    background: transparent;
    border: none;
    color: var(--white);
    font-size: 1.4rem;
    cursor: pointer;
    padding: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    border-radius: 0.4rem;
    transition: background-color var(--transition-fast);
}

.dark-mode-toggle:hover,
.dark-mode-toggle:focus {
    background-color: rgba(255, 255, 255, 0.1);
    outline: none;
}

.dark-mode-toggle i {
    font-size: 1.6rem;
}

/* Dark mode class for manual toggling */
body.dark-mode {
    --secondary-color: #121212;
    --text-color: #e0e0e0;
    --text-color-light: #999;
    --text-color-dark: #fff;
    --white: #1e1e1e;
    --gray-light: #2a2a2a;
    --gray-medium: #444;
    --box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    --box-shadow-hover: 0 4px 12px rgba(0,0,0,0.4);
}

body.dark-mode .article-title-link,
body.dark-mode .content-area h1,
body.dark-mode .widget-title {
    color: #6a6aff;
}

body.dark-mode .article .read-more:hover,
body.dark-mode .category-filter.active,
body.dark-mode .search-form button,
body.dark-mode .newsletter-form button,
body.dark-mode .pagination-btn.active,
body.dark-mode .scroll-top {
    background-color: #3333cc;
}

body.dark-mode .article-category {
    background-color: #3333cc;
}

body.dark-mode img {
    filter: brightness(0.9);
}

body.dark-mode .logo-container img,
body.dark-mode .recent-post img,
body.dark-mode .article-image {
    filter: brightness(0.9) contrast(1.1);
}
    
    .featured-badge {
        position: absolute;
        top: 0;
        left: 2rem;
        background: var(--primary-color);
        color: var(--white);
        padding: 0.5rem 1.5rem;
        font-size: 1.2rem;
        border-radius: 0 0 1rem 1rem;
        text-transform: uppercase;
        font-weight: 600;
        z-index: 3;
    }
    
    /* Sidebar Content */
    .sidebar-content {
        flex: 1;
    }
    
    /* Category navigation */
    .categories-widget {
        background: var(--white);
        border-radius: var(--border-radius);
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: var(--box-shadow);
    }
    
    .categories-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .category-item {
        margin-bottom: 1rem;
    }
    
    .category-item a {
        display: flex;
        align-items: center;
        color: var(--text-color);
        text-decoration: none;
        padding: 0.8rem 1rem;
        border-radius: 0.4rem;
        transition: background-color var(--transition-medium);
    }
    
    .category-item a:hover, .category-item a:focus {
        background-color: var(--gray-light);
        outline: none;
    }
    
    .category-item i {
        margin-right: 1rem;
        width: 2rem;
        text-align: center;
        color: var(--primary-color);
    }
    
    /* Widget Styles */
    .widget {
        background: var(--white);
        border-radius: var(--border-radius);
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: var(--box-shadow);
    }
    
    .widget-title {
        color: var(--primary-color);
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--gray-light);
    }
    
    /* Search Widget */
    .search-form {
        display: flex;
        flex-direction: column;
    }
    
    .search-form input {
        width: 100%;
        padding: 1rem;
        border: 1px solid var(--gray-medium);
        border-radius: 0.4rem;
        margin-bottom: 1rem;
        transition: border-color var(--transition-fast);
    }
    
    .search-form input:focus {
        border-color: var(--primary-color);
        outline: none;
        box-shadow: 0 0 0 2px rgba(0, 0, 128, 0.1);
    }
    
    .search-form button {
        width: 100%;
        padding: 1rem;
        background: var(--primary-color);
        color: var(--white);
        border: none;
        border-radius: 0.4rem;
        cursor: pointer;
        font-weight: 500;
        transition: background-color var(--transition-fast);
    }
    
    .search-form button:hover, .search-form button:focus {
        background-color: var(--primary-color-dark);
        outline: none;
    }
    
    /* Recent Posts */
    .recent-post {
        display: flex;
        align-items: flex-start;
        margin-bottom: 1.5rem;
        padding: 1rem;
        border: 1px solid var(--gray-light);
        border-radius: 0.4rem;
        background: var(--white);
        transition: background-color var(--transition-fast);
    }
    
    .recent-post:hover, .recent-post:focus-within {
        background: var(--gray-light);
    }
    
    .recent-post img {
        width: 8rem;
        height: 8rem;
        border-radius: 0.4rem;
        margin-right: 1rem;
        object-fit: cover;
    }
    
    .recent-post-content h3 {
        font-size: 1.4rem;
        margin: 0;
        line-height: 1.4;
    }
    
    .recent-post-content a {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
        transition: color var(--transition-fast);
    }
    
    .recent-post-content a:hover, .recent-post-content a:focus {
        color: var(--primary-color-light);
        text-decoration: underline;
        outline: none;
    }
    
    /* Popular Tags Widget */
    .tags-widget {
        display: flex;
        flex-wrap: wrap;
        gap: 0.8rem;
    }
    
    .tag-item {
        background-color: var(--gray-light);
        padding: 0.5rem 1.2rem;
        border-radius: 1.5rem;
        font-size: 1.3rem;
        transition: background-color var(--transition-fast);
        cursor: pointer;
        display: inline-flex;
        align-items: center;
    }
    
    .tag-item:hover, .tag-item:focus {
        background-color: var(--gray-medium);
        outline: none;
    }
    
    .tag-count {
        background-color: var(--primary-color);
        color: var(--white);
        padding: 0.2rem 0.6rem;
        border-radius: 1rem;
        font-size: 1rem;
        margin-left: 0.5rem;
        display: inline-block;
    }
    
    /* Newsletter Widget */
    .newsletter-form {
        display: flex;
        flex-direction: column;
    }
    
    .newsletter-form input {
        width: 100%;
        padding: 1rem;
        border: 1px solid var(--gray-medium);
        border-radius: 0.4rem;
        margin-bottom: 1rem;
        transition: border-color var(--transition-fast);
    }
    
    .newsletter-form input:focus {
        border-color: var(--primary-color);
        outline: none;
        box-shadow: 0 0 0 2px rgba(0, 0, 128, 0.1);
    }
    
    .newsletter-form button {
        width: 100%;
        padding: 1rem;
        background: var(--primary-color);
        color: var(--white);
        border: none;
        border-radius: 0.4rem;
        cursor: pointer;
        font-weight: 500;
        transition: background-color var(--transition-fast);
    }
    
    .newsletter-form button:hover, .newsletter-form button:focus {
        background-color: var(--primary-color-dark);
        outline: none;
    }
    
    /* Footer */
    .footer {
        background: var(--primary-color);
        color: var(--white);
        padding: 4rem 2rem 2rem;
        margin-top: 2rem;
    }
    
    .footer-container {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 3rem;
    }
    
    .footer-section h3 {
        color: var(--white);
        font-size: 1.8rem;
        margin-bottom: 2rem;
        position: relative;
        padding-bottom: 1rem;
    }
    
    .footer-section h3::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 5rem;
        height: 2px;
        background-color: var(--white);
    }
    
    .footer-section p {
        color: rgba(255, 255, 255, 0.7);
        margin-bottom: 1.5rem;
        font-size: 1.4rem;
        line-height: 1.6;
    }
    /* Force social media icons to be visible in both light and dark modes */
.footer-social a {
  color: var(--white) !important;
  background-color: var(--primary-color) !important;
}

.footer-social a:hover, .footer-social a:focus {
  opacity: 0.8 !important;
  background-color: var(--primary-color-dark) !important;
}
    .footer-links {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .footer-links li {
        margin-bottom: 1rem;
    }
    
    .footer-links a {
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        transition: color var(--transition-fast);
        font-size: 1.4rem;
        display: inline-block;
    }
    
    .footer-links a:hover, .footer-links a:focus {
        color: var(--white);
        outline: none;
    }
    
    .footer-social {
        display: flex;
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .footer-social a {
        color: var(--white);
        font-size: 1.8rem;
        transition: opacity var(--transition-fast);
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 3.6rem;
        height: 3.6rem;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
    }
    
    .footer-social a:hover, .footer-social a:focus {
        opacity: 0.8;
        background-color: rgba(255, 255, 255, 0.2);
        outline: none;
    }
    
    .footer-bottom {
        text-align: center;
        padding-top: 2rem;
        margin-top: 2rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .footer-bottom p {
        margin: 0;
        color: rgba(255, 255, 255, 0.7);
        font-size: 1.4rem;
    }
    
    .footer-bottom a {
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        transition: color var(--transition-fast);
    }
    
    .footer-bottom a:hover, .footer-bottom a:focus {
        color: var(--white);
        text-decoration: underline;
        outline: none;
    }
    
    /* Pagination */
    .pagination {
        display: flex;
        justify-content: center;
        margin: 3rem 0;
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    
    .pagination-btn {
        padding: 0.8rem 1.5rem;
        background-color: var(--white);
        border: 1px solid var(--gray-medium);
        margin: 0 0.5rem;
        cursor: pointer;
        border-radius: 0.4rem;
        transition: all var(--transition-fast);
        font-size: 1.4rem;
    }
    
    .pagination-btn.active {
        background-color: var(--primary-color);
        color: var(--white);
        border-color: var(--primary-color);
    }
    
    .pagination-btn:hover, .pagination-btn:focus {
        background-color: var(--gray-light);
        outline: none;
    }
    
    .pagination-btn.active:hover, .pagination-btn.active:focus {
        background-color: var(--primary-color-dark);
    }
    
    /* Loading indicator */
    .loading {
        text-align: center;
        padding: 2rem;
    }
    
    .loading-spinner {
      display: inline-block;
      width: 4rem;
      height: 4rem;
      border: 0.4rem solid var(--gray-light);
      border-top: 0.4rem solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
  }
  
  /* Share buttons */
  .share-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
  }
  
  .share-btn {
      padding: 0.5rem 1rem;
      border-radius: 0.4rem;
      color: var(--white);
      cursor: pointer;
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      text-decoration: none;
      transition: opacity var(--transition-fast), transform var(--transition-fast);
  }
  
  .share-btn:hover, .share-btn:focus {
      opacity: 0.9;
      color: var(--white);
      text-decoration: none;
      transform: translateY(-2px);
      outline: none;
  }
  
  .share-btn i {
      margin-right: 0.5rem;
  }
  
  .facebook-share {
      background-color: #3b5998;
  }
  
  .twitter-share {
      background-color: #1da1f2;
  }
  
  .whatsapp-share {
      background-color: #25d366;
  }
  
  .linkedin-share {
      background-color: #0077b5;
  }
  
  .email-share {
      background-color: #777;
  }
  
  /* Scroll to top button */
  .scroll-top {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 4rem;
      height: 4rem;
      background-color: var(--primary-color);
      color: var(--white);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      opacity: 0;
      transition: opacity var(--transition-medium), background-color var(--transition-fast);
      z-index: 999;
      border: none;
  }
  
  .scroll-top.visible {
      opacity: 1;
  }
  
  .scroll-top:hover, .scroll-top:focus {
      background-color: var(--primary-color-dark);
      outline: none;
  }
  
  /* Cookie consent banner */
  .cookie-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--white);
      padding: 1.5rem;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      z-index: 1000;
      display: none;
  }
  
  .cookie-banner.show {
      display: block;
      animation: slideUp 0.5s forwards;
  }
  
  .cookie-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1.5rem;
  }
  
  .cookie-text {
      flex: 3;
      min-width: 280px;
  }
  
  .cookie-text p {
      margin: 0;
      font-size: 1.4rem;
  }
  
  .cookie-buttons {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
  }
  
  .cookie-btn {
      padding: 0.8rem 1.5rem;
      border-radius: 0.4rem;
      font-weight: 500;
      cursor: pointer;
      font-size: 1.4rem;
      border: none;
      transition: background-color var(--transition-fast);
  }
  
  .cookie-accept {
      background-color: var(--primary-color);
      color: var(--white);
  }
  
  .cookie-accept:hover, .cookie-accept:focus {
      background-color: var(--primary-color-dark);
      outline: none;
  }
  
  .cookie-decline {
      background-color: var(--gray-light);
      color: var(--text-color);
  }
  
  .cookie-decline:hover, .cookie-decline:focus {
      background-color: var(--gray-medium);
      outline: none;
  }
  
  @keyframes slideUp {
      from { transform: translateY(100%); }
      to { transform: translateY(0); }
  }
  
  /* Rich Snippets & SEO Enhancement */
  .article-meta {
      display: flex;
      align-items: center;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      gap: 1.5rem;
  }
  
  .article-author {
      display: flex;
      align-items: center;
      color: var(--text-color-light);
      font-size: 1.4rem;
  }
  
  .article-author img {
      width: 2.4rem;
      height: 2.4rem;
      border-radius: 50%;
      margin-right: 0.5rem;
  }
  
  .reading-time {
      display: flex;
      align-items: center;
      color: var(--text-color-light);
      font-size: 1.4rem;
  }
  
  .reading-time i {
      margin-right: 0.5rem;
  }
  
  /* Article Card Hover Effects */
  .article-card-hover {
      transition: transform var(--transition-medium), box-shadow var(--transition-medium);
  }
  
  .article-card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
  }
  
  /* Article Action Buttons */
  .article-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
  }
  
  /* Breadcrumbs */
  .breadcrumbs {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 2rem;
      font-size: 1.4rem;
      color: var(--text-color-light);
  }
  
  .breadcrumbs a {
      color: var(--primary-color);
      text-decoration: none;
  }
  
  .breadcrumbs a:hover, .breadcrumbs a:focus {
      text-decoration: underline;
      outline: none;
  }
  
  .breadcrumbs .separator {
      margin: 0 0.5rem;
  }
  
  .breadcrumbs .current {
      font-weight: 500;
      color: var(--text-color);
  }
  
  /* Hero Section for Special Features */
  .hero-section {
      background-color: var(--primary-color);
      color: var(--white);
      padding: 4rem 2rem;
      margin-bottom: 3rem;
      text-align: center;
      border-radius: var(--border-radius);
  }
  
  .hero-section h2 {
      font-size: 3rem;
      margin-bottom: 1.5rem;
      font-weight: 700;
  }
  
  .hero-section p {
      font-size: 1.8rem;
      max-width: 700px;
      margin: 0 auto 2rem;
      opacity: 0.9;
  }
  
  .hero-btn {
      display: inline-block;
      padding: 1rem 2rem;
      background-color: var(--white);
      color: var(--primary-color);
      border-radius: 0.4rem;
      font-weight: 600;
      text-decoration: none;
      transition: all var(--transition-fast);
  }
  
  .hero-btn:hover, .hero-btn:focus {
      background-color: rgba(255, 255, 255, 0.9);
      transform: translateY(-2px);
      outline: none;
  }
  
  /* Print styles */
  @media print {
      .site-header, 
      .sidebar-content, 
      .footer, 
      .scroll-top, 
      .share-buttons,
      .cookie-banner {
          display: none !important;
      }
      
      .main-container {
          display: block;
          margin: 0;
          padding: 0;
      }
      
      .content-area {
          width: 100%;
      }
      
      .article {
          break-inside: avoid;
          box-shadow: none;
          border: 1px solid #ddd;
          margin-bottom: 2cm;
      }
      
      .article-image {
          max-height: 250px;
      }
      
      body {
          font-size: 12pt;
          line-height: 1.5;
          background: none;
          color: #000;
      }
      
      h1, h2, h3 {
          page-break-after: avoid;
      }
      
      a {
          text-decoration: none;
          color: #000;
      }
      
      a::after {
          content: " (" attr(href) ")";
          font-size: 90%;
          color: #333;
      }
  }
  
  /* Responsive Design */
  @media (max-width: 992px) {
      html {
          font-size: 58%;
      }
      
      .main-container {
          flex-direction: column;
          padding: 1.5rem;
      }
      
      .content-area {
          margin-bottom: 2rem;
      }
      
      .sidebar-content {
          width: 100%;
      }
      
      .footer-container {
          grid-template-columns: repeat(2, 1fr);
      }
  }
  
  @media (max-width: 768px) {
      html {
          font-size: 55%;
      }
      
      .site-header {
          flex-direction: column;
          align-items: flex-start;
          padding: 1rem;
      }
      
      .logo-container {
          margin-bottom: 1rem;
          width: 100%;
          justify-content: space-between;
          align-items: center;
      }
      
      .logo-container > div:first-child {
          display: flex;
          align-items: center;
      }
      
      .nav-links {
          display: none;
          width: 100%;
          flex-direction: column;
          gap: 0.5rem;
      }
      
      .nav-links.show {
          display: flex;
      }
      
      .mobile-menu-toggle {
          display: block;
      }
      
      .main-container {
          padding: 1rem;
      }
      
      .content-area h1 {
          font-size: 2.8rem;
      }
      
      .content-area h2 {
          font-size: 2rem;
      }
      
      .article h2 {
          font-size: 2rem;
      }
      
      .article h3 {
          font-size: 1.6rem;
      }
      
      .article p {
          font-size: 1.4rem;
      }
      
      .article-image-container {
          max-width: 100%;
      }
      
      .recent-post img {
          width: 6rem;
          height: 6rem;
      }
      
      .footer-container {
          grid-template-columns: 1fr;
          gap: 2rem;
      }
      
      .share-buttons {
          flex-wrap: wrap;
      }
      
      .cookie-content {
          flex-direction: column;
          align-items: flex-start;
      }
      
      .cookie-text {
          margin-bottom: 1rem;
      }
  }
  
  @media (max-width: 480px) {
      html {
          font-size: 52%;
      }
      
      .article {
          padding: 1.5rem;
      }
      
      .article-image {
          max-height: 300px;
      }
      
      .pagination-btn {
          padding: 0.6rem 1rem;
          font-size: 1.3rem;
      }
  }
  
  /* Accessibility Enhancements */
  .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
  }
  
  :focus {
      outline: 3px solid rgba(0, 0, 128, 0.3);
      outline-offset: 2px;
  }
  
  :focus:not(:focus-visible) {
      outline: none;
  }
  
  :focus-visible {
      outline: 3px solid rgba(0, 0, 128, 0.5);
      outline-offset: 2px;
  }
  
  /* Dark mode support */
  @media (prefers-color-scheme: dark) {
      :root {
          --secondary-color: #121212;
          --text-color: #e0e0e0;
          --text-color-light: #999;
          --text-color-dark: #fff;
          --white: #1e1e1e;
          --gray-light: #2a2a2a;
          --gray-medium: #444;
          --box-shadow: 0 2px 8px rgba(0,0,0,0.3);
          --box-shadow-hover: 0 4px 12px rgba(0,0,0,0.4);
      }
      
      .article-title-link,
      .content-area h1,
      .widget-title {
          color: #6a6aff;
      }
      
      .article .read-more:hover,
      .category-filter.active,
      .search-form button,
      .newsletter-form button,
      .pagination-btn.active,
      .scroll-top {
          background-color: #3333cc;
      }
      
      .article-category {
          background-color: #3333cc;
      }
      
      img {
          filter: brightness(0.9);
      }
      
      .logo-container img,
      .recent-post img,
      .article-image {
          filter: brightness(0.9) contrast(1.1);
      }
  }
  
  /* Utility Classes */
  .text-primary { color: var(--primary-color) !important; }
  .text-light { color: var(--text-color-light) !important; }
  .bg-primary { background-color: var(--primary-color) !important; }
  .bg-light { background-color: var(--gray-light) !important; }
  .rounded { border-radius: var(--border-radius) !important; }
  .shadow { box-shadow: var(--box-shadow) !important; }
  .p-1 { padding: 1rem !important; }
  .p-2 { padding: 2rem !important; }
  .m-1 { margin: 1rem !important; }
  .m-2 { margin: 2rem !important; }
  .mb-1 { margin-bottom: 1rem !important; }
  .mb-2 { margin-bottom: 2rem !important; }
  .flex { display: flex !important; }
  .flex-column { flex-direction: column !important; }
  .justify-between { justify-content: space-between !important; }
  .align-center { align-items: center !important; }
  .text-center { text-align: center !important; }
  .font-bold { font-weight: 700 !important; }
  .w-100 { width: 100% !important; }
  .hidden { display: none !important; }
  </style>
  <style id="force-light-mode">
/* Force light mode by overriding the media query */
:root {
  --primary-color: #000080;
  --primary-color-dark: #000066;
  --primary-color-light: #3333cc;
  --secondary-color: #f4f4f9;
  --text-color: #333;
  --text-color-light: #666;
  --text-color-dark: #000;
  --white: #fff;
  --gray-light: #f0f0f0;
  --gray-medium: #ddd;
  --border-radius: 10px;
  --box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  --box-shadow-hover: 0 4px 8px rgba(0,0,0,0.15);
  --transition-fast: 0.2s;
  --transition-medium: 0.3s;
  --font-family: 'Poppins', sans-serif;
  --h1-color: red; /* New variable for h1 color */
  --h2-font-size: 16px; /* Variable for h2 size */
}

/* Then update your styling */
.main-title {
  color: var(--h1-color) !important;
  display: flex;
  align-items: center;
}

.main-title img {
  margin-right: 10px;
}

#pageSubtitle {
  font-size: var(--h2-font-size);
}

body {
  background-color: var(--secondary-color) !important;
  color: var(--text-color) !important;
}

.article-title-link,
.content-area h1,
.widget-title {
  color: var(--primary-color) !important;
}

img {
  filter: none !important;
}

.logo-container img,
.recent-post img,
.article-image {
  filter: none !important;
}

/* Override dark mode class */
body.dark-mode {
  --secondary-color: #f4f4f9 !important;
  --text-color: #333 !important;
  --text-color-light: #666 !important;
  --text-color-dark: #000 !important;
  --white: #fff !important;
  --gray-light: #f0f0f0 !important;
  --gray-medium: #ddd !important;
  --box-shadow: 0 2px 5px rgba(0,0,0,0.1) !important;
  --box-shadow-hover: 0 4px 8px rgba(0,0,0,0.15) !important;
}
.main-title {
  color: red !important;
  display: flex;
  align-items: center;
}
 
.main-title img {
  margin-right: 10px; /* Adds space between image and text */
}

#pageSubtitle {
  font-size: 16px !important;
}
</style>
</head>
<body>

<!-- News Flasher -->
<div class="news-flasher">
  <div class="flasher-label">LAATSTE NIEUWS</div>
  <div class="flasher-container">
    <div class="flasher-content" id="flasher-content">
      <!-- Headlines will be populated dynamically -->
      <span>Laden van het laatste nieuws...</span>
    </div>
  </div>
</div>

<style>
  /* News Flasher Styles */
  .news-flasher {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background-color: #000080;
    color: white;
    display: flex;
    height: 40px;
    align-items: center;
    z-index: 9999;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    font-family: var(--font-family);
  }

  .flasher-label {
    background-color: #ff0000;
    color: white;
    font-weight: bold;
    padding: 0 15px;
    height: 100%;
    display: flex;
    align-items: center;
    font-size: 16px;
    min-width: 140px;
    justify-content: center;
    position: relative;
    z-index: 2;
    text-transform: uppercase;
    animation: pulse-bg 1.5s infinite;
  }

  @keyframes pulse-bg {
    0%, 100% { background-color: #cc0000; }
    50% { background-color: #ff0000; }
  }

  .flasher-label::after {
    content: '';
    position: absolute;
    right: -10px;
    top: 50%;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border-top: 10px solid transparent;
    border-bottom: 10px solid transparent;
    border-left: 10px solid #ff0000;
    z-index: 2;
    animation: pulse-arrow 1.5s infinite;
  }

  @keyframes pulse-arrow {
    0%, 100% { border-left-color: #cc0000; }
    50% { border-left-color: #ff0000; }
  }

  .flasher-container {
    overflow: hidden;
    position: relative;
    height: 100%;
    flex: 1;
    margin-left: 10px;
  }

  .flasher-content {
    display: flex;
    align-items: center;
    position: absolute;
    white-space: nowrap;
    animation: scroll-news 45s linear infinite;
    height: 100%;
    padding-left: 100%;
  }

  .flasher-content:hover {
    animation-play-state: paused;
  }

  @keyframes scroll-news {
    0% { transform: translateX(0); }
    100% { transform: translateX(-100%); }
  }

  .flasher-content span {
    padding: 0 20px;
    font-weight: 500;
    font-size: 15px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    height: 100%;
    transition: background-color 0.2s;
  }

  .flasher-content span:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }

  .flasher-separator {
    color: rgba(255, 255, 255, 0.7);
    font-size: 16px;
    padding: 0 5px;
    margin: 0;
    cursor: default;
  }

  /* Adjust existing elements to make room for the flasher */
  body {
    padding-top: 40px;
  }

  .site-header {
    top: 40px;
    position: sticky;
    z-index: 998;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .flasher-label {
      font-size: 14px;
      min-width: 120px;
      padding: 0 10px;
    }
    
    .flasher-content span {
      font-size: 14px;
      padding: 0 10px;
    }
  }
</style>

<script>
  // Populate the news flasher dynamically
  document.addEventListener('DOMContentLoaded', function() {
    const flasherContent = document.getElementById('flasher-content');
    
    // Function to populate news flasher from Firebase articles
    function populateNewsFlasher(articles) {
      if (!articles || !articles.length) {
        console.log("No articles for news flasher");
        return;
      }
      
      // Sort articles by timestamp (newest first)
      const sortedArticles = [...articles].sort((a, b) => {
        if (!a.timestamp && !b.timestamp) return 0;
        if (!a.timestamp) return 1;
        if (!b.timestamp) return -1;
        return Math.abs(b.timestamp) - Math.abs(a.timestamp);
      });
      
      // Take the top 10 articles for the flasher
      const flasherArticles = sortedArticles.slice(0, 10);
      
      // Build the HTML content
      let flasherHtml = '';
      
      flasherArticles.forEach((article, index) => {
        // Clean the title
        let title = article.title || 'Nieuws Update';
        if (title.length > 100) {
          title = title.substring(0, 97) + '...';
        }
        
        // Generate slug
        const slug = article.slug || createSafeSlug(title);
        
        // Add the news item
        flasherHtml += `<span data-slug="${slug}">${title}</span>`;
        
        // Add separator if not the last item
        if (index < flasherArticles.length - 1) {
          flasherHtml += `<span class="flasher-separator">•</span>`;
        }
      });
      
      // Set the content
      if (flasherContent) {
        flasherContent.innerHTML = flasherHtml;
        
        // Duplicate content for seamless looping
        flasherContent.innerHTML += flasherHtml;
        
        // Add click events to news items
        const newsItems = flasherContent.querySelectorAll('span:not(.flasher-separator)');
        newsItems.forEach(item => {
          item.addEventListener('click', function() {
            const slug = this.getAttribute('data-slug');
            if (slug) {
              window.location.href = `/article/${slug}`;
            }
          });
        });
      }
    }
    
    // Helper function to create slug if not available
    function createSafeSlug(title) {
      if (!title) return 'artikel';
      try {
        return title.toLowerCase()
          .replace(/[^\w\s-]/g, '')
          .replace(/\s+/g, '-')
          .replace(/-+/g, '-');
      } catch (e) {
        console.error("Error creating slug:", e);
        return 'artikel';
      }
    }
    
    // Try to access the articles data from the global scope
    // This assumes the articles will be loaded by the main script
    function checkAndPopulateFlasher() {
      // Check if allArticles is available from the main script
      if (typeof window.allArticles !== 'undefined' && window.allArticles.length > 0) {
        populateNewsFlasher(window.allArticles);
      } else {
        // If articles aren't loaded yet, try to access Firebase directly
        try {
          const app = firebase.app();
          const db = firebase.database();
          const articlesRef = db.ref('articles');
          
          articlesRef.once('value').then(snapshot => {
            if (snapshot.exists()) {
              const articlesData = snapshot.val();
              const articlesArray = Object.values(articlesData);
              populateNewsFlasher(articlesArray);
            }
          }).catch(error => {
            console.error("Error getting articles for flasher:", error);
          });
        } catch (e) {
          console.log("Firebase not directly accessible, will wait for main script");
          
          // Set a retry timer to check again in a few seconds
          setTimeout(checkAndPopulateFlasher, 3000);
        }
      }
    }
    
    // Start checking for articles
    checkAndPopulateFlasher();
    
    // Listen for a custom event that might be triggered when articles are loaded
    document.addEventListener('articlesLoaded', function(e) {
      if (e.detail && e.detail.articles) {
        populateNewsFlasher(e.detail.articles);
      }
    });
  });
</script>

  <!-- Skip to main content link for accessibility -->
  <a href="#main-content" class="skip-to-content">Skip to main content</a>
  
  <header class="site-header" role="banner">
    <div class="logo-container">
        <div>
            <img src="https://hetnieuws.app/hetnieuws-app-logo.png" alt="HetNieuws.app - Nieuws, Actuele Berichten uit Nederland en de Wereld" width="40" height="40">
            <a href="/" title="HetNieuws.app - Home">HetNieuws.app</a>
        </div>
        <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Menu openen" aria-expanded="false">
            <i class="fas fa-bars" aria-hidden="true"></i>
        </button>
    </div>
    <nav class="nav-links" id="navLinks" role="navigation" aria-label="Hoofdnavigatie">
        <a href="/" title="Naar de homepagina"><i class="fas fa-home" aria-hidden="true"></i> Home</a>
        <a href="/search" title="Zoek in artikelen"><i class="fas fa-search" aria-hidden="true"></i> Vertalen</a>
        <a href="/categories" title="Bekijk alle categorieën"><i class="fas fa-list" aria-hidden="true"></i> Categorieën</a>
        <a href="/contact" title="Neem contact met ons op"><i class="fas fa-envelope" aria-hidden="true"></i> Meedenken</a>
        <a href="/about" title="Over HetNieuws.app"><i class="fas fa-info-circle" aria-hidden="true"></i> Over Ons</a>
        
        <!-- Add dark mode toggle button -->
        <button id="darkModeToggle" class="dark-mode-toggle" aria-label="Donkere modus schakelen">
            <i class="fas fa-moon" aria-hidden="true" id="darkModeIcon"></i>
            <span id="darkModeText">Donker</span>
        </button>
    </nav>
</header>
  
  <main id="main-content" class="main-container">
      <section class="content-area" role="main">
          <nav aria-label="Breadcrumb" class="breadcrumbs">
              <a href="/">Home</a>
              <span class="separator" aria-hidden="true"><i class="fas fa-chevron-right"></i></span>
              <span class="current">Laatste Nieuws</span>
          </nav>
          <h1 class="main-title">
  <img src="https://hetnieuws.app/hetnieuws-app-logo.png" 
       alt="Nieuws en Actuele Berichten uit Nederland en de Wereld HetNieuws.app" width="40" height="40">
  HetNieuws.app
</h1>
<h2 id="pageSubtitle">Nieuws en Actuele Berichten uit Nederland en de Wereld</h2>
          
          <div class="category-filters" id="categoryFilters" aria-label="Categorie filters" role="group">
              <!-- Category filters will be added by JavaScript -->
          </div>
          
          <div id="loading" class="loading" aria-label="Laden">
              <div class="loading-spinner" aria-hidden="true"></div>
              <p>Artikelen laden...</p>
          </div>
          
          <div id="articles-container" aria-live="polite">
              <!-- Articles will be loaded here -->
          </div>
          
          <nav id="pagination" class="pagination" aria-label="Paginatie">
              <!-- Pagination will be added by JavaScript -->
          </nav>
      </section>
      
      <aside class="sidebar-content" role="complementary" aria-label="Sidebar">
          <div class="widget">
              <h3 class="widget-title">Zoeken</h3>
              <form class="search-form" id="searchForm" role="search">
                  <label for="searchInput" class="visually-hidden">Zoeken naar artikelen</label>
                  <input type="text" id="searchInput" name="query" placeholder="Zoeken..." aria-label="Zoeken">
                  <button type="submit">Zoeken</button>
              </form>
          </div>
          
          <nav class="categories-widget">
              <h3 class="widget-title">Categorieën</h3>
              <ul class="categories-list" id="sidebarCategoryList">
                  <!-- Categories will be populated by JavaScript -->
              </ul>
          </nav>
          
          <section class="widget">
              <h3 class="widget-title">Recente Artikelen</h3>
              <ul id="recent-posts-list" class="recent-posts-list" aria-label="Recente artikelen">
                  <!-- Recent posts will be loaded by JavaScript -->
              </ul>
          </section>
          
          <section class="widget">
              <h3 class="widget-title">Populaire Tags</h3>
              <div class="tags-widget" id="popularTags" aria-label="Populaire tags">
                  <!-- Popular tags will be populated by JavaScript -->
              </div>
          </section>
          
          <section class="widget">
              <h3 class="widget-title">Nieuwsbrief</h3>
              <p>Schrijf je in voor onze nieuwsbrief om op de hoogte te blijven van het laatste nieuws.</p>
              <form class="newsletter-form" id="newsletterForm">
                  <label for="newsletter-email" class="visually-hidden">E-mailadres voor nieuwsbrief</label>
                  <input type="email" id="newsletter-email" name="email" placeholder="Jouw e-mailadres" required aria-required="true">
                  <button type="submit">Inschrijven</button>
              </form>
          </section>
          
          <section class="widget">
              <h3 class="widget-title">Volg Ons</h3>
              <div class="footer-social">
<a href="#" title="Volg ons op Facebook" aria-label="Facebook" rel="nofollow"><i class="fab fa-facebook-f" aria-hidden="true"></i></a>
<a href="#" title="Volg ons op Twitter" aria-label="Twitter" rel="nofollow"><i class="fab fa-twitter" aria-hidden="true"></i></a>
<a href="#" title="Volg ons op Instagram" aria-label="Instagram" rel="nofollow"><i class="fab fa-instagram" aria-hidden="true"></i></a>
<a href="#" title="Volg ons op LinkedIn" aria-label="LinkedIn" rel="nofollow"><i class="fab fa-linkedin-in" aria-hidden="true"></i></a>
</div>          </section>
      </aside>
  </main>
  
  <footer class="footer" role="contentinfo">
      <div class="footer-container">
          <div class="footer-section">
              <h3>Over HetNieuws.app</h3>
              <p>HetNieuws.app biedt het laatste nieuws uit Nederland, gebracht met zorg en aandacht voor kwaliteit en betrouwbaarheid. Onze redactie streeft naar eerlijke en onpartijdige berichtgeving over alles wat speelt in ons land.</p>
              <div class="footer-social">
<a href="#" title="Volg ons op Facebook" aria-label="Facebook" rel="nofollow"><i class="fab fa-facebook-f" aria-hidden="true"></i></a>
<a href="#" title="Volg ons op Twitter" aria-label="Twitter" rel="nofollow"><i class="fab fa-twitter" aria-hidden="true"></i></a>
<a href="#" title="Volg ons op Instagram" aria-label="Instagram" rel="nofollow"><i class="fab fa-instagram" aria-hidden="true"></i></a>
<a href="#" title="Volg ons op LinkedIn" aria-label="LinkedIn" rel="nofollow"><i class="fab fa-linkedin-in" aria-hidden="true"></i></a>
</div>          </div>
          <div class="footer-section">
              <h3>Navigatie</h3>
              <ul class="footer-links">
                  <li><a href="/" title="Naar de homepagina">Home</a></li>
                  <li><a href="/categories" title="Bekijk alle categorieën">Categorieën</a></li>
                  <li><a href="/news-archive" title="Nieuwsarchief">Nieuws Archief</a></li>
                  <li><a href="/popular" title="Populaire artikelen">Populaire Artikelen</a></li>
                  <li><a href="/about" title="Over HetNieuws.app">Over Ons</a></li>
                  <li><a href="/contact" title="Neem contact met ons op">Contact</a></li>
              </ul>
          </div>
          <div class="footer-section">
              <h3>Juridisch</h3>
              <ul class="footer-links">
                  <li><a href="/privacy-policy" title="Lees ons privacybeleid">Privacybeleid</a></li>
                  <li><a href="/cookie-policy" title="Lees ons cookiebeleid">Cookiebeleid</a></li>
                  <li><a href="/terms-of-service" title="Lees onze gebruiksvoorwaarden">Gebruiksvoorwaarden</a></li>
                  <li><a href="/disclaimer" title="Lees onze disclaimer">Disclaimer</a></li>
                  <li><a href="/accessibility" title="Toegankelijkheidsverklaring">Toegankelijkheid</a></li>
              </ul>
          </div>
      </div>
      <div class="footer-bottom">
  <p>&copy; 2025 HetNieuws.app - Alle rechten voorbehouden | Oldenburger 
  </p>
</div>  </footer>
  
  <button class="scroll-top" id="scrollTop" aria-label="Scroll naar boven">
      <i class="fas fa-arrow-up" aria-hidden="true"></i>
  </button>
  
  <div class="cookie-banner" id="cookieBanner">
      <div class="cookie-content">
          <div class="cookie-text">
              <p>Deze website maakt gebruik van cookies om uw ervaring te verbeteren. Door de site te blijven gebruiken, gaat u akkoord met ons cookie-beleid.</p>
          </div>
          <div class="cookie-buttons">
              <button class="cookie-btn cookie-accept" id="acceptCookies">Accepteren</button>
              <button class="cookie-btn cookie-decline" id="declineCookies">Weigeren</button>
              <a href="/cookie-policy" class="cookie-btn cookie-decline">Meer informatie</a>
          </div>
      </div>
  </div>
<script>
// Immediately execute dark mode initialization
(function() {
    // Wait for DOM to be fully loaded
    window.addEventListener('DOMContentLoaded', function() {
        console.log("Setting up dark mode toggle...");
        const darkModeToggle = document.getElementById('darkModeToggle');
        
        if (!darkModeToggle) {
            console.warn("Dark mode toggle button not found");
            return;
        }
        
        const darkModeIcon = document.getElementById('darkModeIcon');
        const darkModeText = document.getElementById('darkModeText');
        
        // Function to update UI based on current dark mode state
        function updateDarkModeUI() {
            const isDark = document.body.classList.contains('dark-mode');
            console.log("Dark mode is: ", isDark ? "ON" : "OFF");
            
            if (darkModeIcon) {
                darkModeIcon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            }
            
            if (darkModeText) {
                darkModeText.textContent = isDark ? 'Licht' : 'Donker';
            }
            
            darkModeToggle.style.backgroundColor = isDark ? 
                'rgba(255, 255, 255, 0.2)' : 'transparent';
        }
        
        // Check for saved dark mode preference or use system preference
        const savedMode = localStorage.getItem('darkMode');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        // Apply dark mode if saved or system preference indicates dark
        if (savedMode === 'dark' || (savedMode === null && prefersDark)) {
            document.body.classList.add('dark-mode');
        } else {
            document.body.classList.remove('dark-mode');
        }
        
        // Set initial UI state
        updateDarkModeUI();
        
        // Add click event to toggle button
        darkModeToggle.addEventListener('click', function(e) {
            console.log("Dark mode toggle clicked");
            e.preventDefault(); // Prevent any default action
            
            // Toggle class on body
            document.body.classList.toggle('dark-mode');
            
            // Save preference
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark ? 'dark' : 'light');
            
            // Update UI elements
            updateDarkModeUI();
            
            // Log analytics event if available
            try {
                if (typeof analytics !== 'undefined' && typeof logEvent === 'function') {
                    logEvent(analytics, 'dark_mode_toggle', {
                        mode: isDark ? 'dark' : 'light'
                    });
                }
            } catch (err) {
                console.log('Analytics not available for dark mode logging');
            }
        });
        
        // Also listen for system preference changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            if (localStorage.getItem('darkMode') === null) {
                // Only apply if user hasn't explicitly set a preference
                if (e.matches) {
                    document.body.classList.add('dark-mode');
                } else {
                    document.body.classList.remove('dark-mode');
                }
                updateDarkModeUI();
            }
        });
    });
})();
</script>
  <script type="module">

  // Import the necessary Firebase modules
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
  import { getDatabase, ref, get, onValue } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js';
  import { getAnalytics, logEvent } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js';
  
  // Firebase configuration - make sure this matches your Firebase project
  const firebaseConfig = {
      apiKey: "AIzaSyDRPdYITsTptnCIRs9wZLeF2HK4Od7WA7w",
      authDomain: "hetnieuws-app.firebaseapp.com",
      databaseURL: "https://hetnieuws-app-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "hetnieuws-app",
      storageBucket: "hetnieuws-app.appspot.com",
      messagingSenderId: "204697555408",
      appId: "1:204697555408:web:d59690190dd02b15bc29d5",
      measurementId: "G-MEASUREMENT_ID" // Add your Analytics measurement ID here
  };
  
  // Add error handling for Firebase initialization
  try {
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      const analytics = getAnalytics(app);
      
      console.log("Firebase initialized successfully");
      
      // Log page view event
      logEvent(analytics, 'page_view', {
          page_title: document.title,
          page_location: window.location.href,
          page_path: window.location.pathname
      });
      
      // State variables
      let allArticles = [];
      let filteredArticles = [];
      let currentPage = 1;
      const articlesPerPage = 10;
      let categories = {};
      let tags = {};
      let categoryCache = {}; // Cache for category filtering
      let currentCategory = 'all';
      let currentTag = null;
      let searchQuery = '';
      
      // Helper function for safe URL encoding
      function safeEncodeURI(text) {
          try {
              // First ensure text is a string
              const str = String(text || '');
              // Then encode it, handling potential URI malformation
              return encodeURIComponent(str);
          } catch (e) {
              console.error("Error encoding URI:", e);
              // Return a fallback safe value
              return "artikel";
          }
      }
      
      // Helper function to create a safe slug
      function createSafeSlug(title) {
          if (!title) return 'artikel';
          try {
              return title.toLowerCase()
                  .replace(/[^\w\s-]/g, '')
                  .replace(/\s+/g, '-')
                  .replace(/-+/g, '-');
          } catch (e) {
              console.error("Error creating slug:", e);
              return 'artikel';
          }
      }
      
      // Helper function to clean article titles
      function cleanArticleTitle(title) {
          if (!title) return 'Artikel zonder titel';
          // Look for common AI explanation patterns and truncate at that point
          const aiPatterns = [
              '. Let op dat ik,', 
              '. Ik moet opmerken', 
              '. Ik wil benadrukken', 
              '. Als AI-', 
              '. Als kunstmatige',
              '. Belangrijk om te weten',
              '. Hierbij wil ik',
              '. Houd er rekening mee',
              '. Merk op dat',
              '. Dit is gebaseerd op'
          ];
          let cleanTitle = title;
          for (const pattern of aiPatterns) {
              const patternIndex = cleanTitle.indexOf(pattern);
              if (patternIndex > 0) {
                  cleanTitle = cleanTitle.substring(0, patternIndex + 1);
                  break;
              }
          }
          return cleanTitle;
      }
      
      // Helper function to format dates in Dutch
      function formatDutchDate(timestamp) {
          if (!timestamp) return '';
          
          // Convert timestamp to milliseconds if it's in seconds
          const milliseconds = timestamp < 10000000000 
              ? timestamp * 1000 
              : timestamp;
              
          const date = new Date(milliseconds);
          
          // Dutch month names
          const dutchMonths = [
          'januari', 'februari', 'maart', 'april', 'mei', 'juni',
          'juli', 'augustus', 'september', 'oktober', 'november', 'december'
      ];
      
      // Format: 15 januari 2023 om 14:30
      const day = date.getDate();
      const month = dutchMonths[date.getMonth()];
      const year = date.getFullYear();
      const hours = date.getHours().toString().padStart(2, '0');
      const minutes = date.getMinutes().toString().padStart(2, '0');
      
      return `${day} ${month} ${year} om ${hours}:${minutes}`;
  }
  
  // Helper function to estimate reading time
  function estimateReadingTime(content) {
      if (!content) return '1 min';
      
      // Average reading speed: 200 words per minute
      const wordCount = content.split(/\s+/).length;
      const readingTimeMinutes = Math.max(1, Math.ceil(wordCount / 200));
      
      return `${readingTimeMinutes} min`;
  }
  
  // DOM elements
  const articlesContainer = document.getElementById('articles-container');
  const recentPostsList = document.getElementById('recent-posts-list');
  const sidebarCategoryList = document.getElementById('sidebarCategoryList');
  const categoryFilters = document.getElementById('categoryFilters');
  const pagination = document.getElementById('pagination');
  const searchForm = document.getElementById('searchForm');
  const searchInput = document.getElementById('searchInput');
  const pageSubtitle = document.getElementById('pageSubtitle');
  const popularTags = document.getElementById('popularTags');
  const loading = document.getElementById('loading');
  const scrollTop = document.getElementById('scrollTop');
  const mobileMenuToggle = document.getElementById('mobileMenuToggle');
  const navLinks = document.getElementById('navLinks');
  const cookieBanner = document.getElementById('cookieBanner');
  const acceptCookies = document.getElementById('acceptCookies');
  const declineCookies = document.getElementById('declineCookies');
  
  // Check URL parameters for category or tag filters
  const urlParams = new URLSearchParams(window.location.search);
  const categoryParam = urlParams.get('category');
  const tagParam = urlParams.get('tag');
  const searchParam = urlParams.get('query');
  
  if (categoryParam) {
      currentCategory = categoryParam;
  }
  if (tagParam) {
      currentTag = tagParam;
  }
  if (searchParam) {
      searchQuery = searchParam;
      searchInput.value = searchParam;
  }
  
  // Cookie consent handling
  function initCookieConsent() {
      const cookieConsent = localStorage.getItem('cookieConsent');
      
      if (!cookieConsent) {
          // Show cookie banner after a short delay
          setTimeout(() => {
              cookieBanner.classList.add('show');
          }, 1000);
      }
      
      acceptCookies.addEventListener('click', () => {
          localStorage.setItem('cookieConsent', 'accepted');
          cookieBanner.classList.remove('show');
          
          // Enable analytics after consent
          logEvent(analytics, 'cookie_consent', { consent: 'accepted' });
      });
      
      declineCookies.addEventListener('click', () => {
          localStorage.setItem('cookieConsent', 'declined');
          cookieBanner.classList.remove('show');
          
          // Disable analytics after declining
          window['ga-disable-' + firebaseConfig.measurementId] = true;
      });
  }
  
  // Mobile menu toggle
  if (mobileMenuToggle) {
      mobileMenuToggle.addEventListener('click', function() {
          navLinks.classList.toggle('show');
          
          // Update ARIA expanded state
          const isExpanded = navLinks.classList.contains('show');
          mobileMenuToggle.setAttribute('aria-expanded', isExpanded);
      });
  }
  
  // Scroll to top button
  window.addEventListener('scroll', function() {
      if (window.pageYOffset > 300) {
          scrollTop.classList.add('visible');
      } else {
          scrollTop.classList.remove('visible');
      }
  });
  
  if (scrollTop) {
      scrollTop.addEventListener('click', function() {
          window.scrollTo({ top: 0, behavior: 'smooth' });
      });
  }
  
  // Load categories and tags
  async function loadCategoriesAndTags() {
      try {
          console.log("Loading categories and tags...");
          
          // Load categories
          const categoriesRef = ref(db, 'categories');
          const categoriesSnapshot = await get(categoriesRef);
          
          if (categoriesSnapshot.exists()) {
              categories = categoriesSnapshot.val();
              console.log("Categories loaded:", Object.keys(categories).length);
              
              // Update category navigation
              updateCategoryNavigation();
          } else {
              console.log("No categories found in database");
          }
          
          // Load tags
          const tagsRef = ref(db, 'tags');
          const tagsSnapshot = await get(tagsRef);
          
          if (tagsSnapshot.exists()) {
              tags = tagsSnapshot.val();
              console.log("Tags loaded:", Object.keys(tags).length);
              
              // Update tag widgets
              updateTagWidgets();
          } else {
              console.log("No tags found in database");
          }
          
          // Load tag statistics
          const tagStatsRef = ref(db, 'statistics/tags');
          const tagStatsSnapshot = await get(tagStatsRef);
          
          if (tagStatsSnapshot.exists()) {
              const tagStats = tagStatsSnapshot.val();
              
              // Add counts to tags
              for (const tagSlug in tags) {
                  const tagName = tags[tagSlug].name;
                  if (tagStats[tagName]) {
                      tags[tagSlug].count = tagStats[tagName];
                  }
              }
              
              // Update tag widgets with counts
              updateTagWidgets();
          }
          
          // Listen for real-time updates to categories
          onValue(categoriesRef, (snapshot) => {
              if (snapshot.exists()) {
                  const updatedCategories = snapshot.val();
                  // Only update if there are actual changes
                  if (JSON.stringify(categories) !== JSON.stringify(updatedCategories)) {
                      categories = updatedCategories;
                      updateCategoryNavigation();
                      // Clear category cache when categories update
                      categoryCache = {};
                  }
              }
          });
          
          // Listen for real-time updates to tags
          onValue(tagsRef, (snapshot) => {
              if (snapshot.exists()) {
                  const updatedTags = snapshot.val();
                  // Only update if there are actual changes
                  if (JSON.stringify(tags) !== JSON.stringify(updatedTags)) {
                      tags = updatedTags;
                      updateTagWidgets();
                  }
              }
          });
          
      } catch (error) {
          console.error('Error loading categories and tags:', error);
      }
  }
  
  // Update category navigation in sidebar and filters
  function updateCategoryNavigation() {
      // Skip if no categories loaded
      if (!categories || Object.keys(categories).length === 0) {
          console.log("No categories to display");
          return;
      }
      
      // Add icon mapping for categories
      const categoryIcons = {
          'politiek': 'fa-landmark',
          'economie': 'fa-chart-line',
          'sport': 'fa-futbol',
          'wetenschap': 'fa-flask',
          'technologie': 'fa-microchip',
          'gezondheid': 'fa-heartbeat',
          'onderwijs': 'fa-graduation-cap',
          'milieu': 'fa-leaf',
          'entertainment': 'fa-film',
          'cultuur': 'fa-theater-masks',
          'reizen': 'fa-plane',
          'eten': 'fa-utensils',
          'lifestyle': 'fa-spa',
          'weer': 'fa-cloud-sun',
          'veiligheid': 'fa-shield-alt',
          'internationaal': 'fa-globe-europe'
      };
      
      // Clear existing sidebar category items
      if (sidebarCategoryList) {
          sidebarCategoryList.innerHTML = `
          <li class="category-item">
              <a href="#" data-category="all" aria-current="${currentCategory === 'all' ? 'page' : 'false'}">
                  <i class="fas fa-globe" aria-hidden="true"></i> Alle Categorieën
              </a>
          </li>
          `;
      }
      
      // Add each category to sidebar navigation
      for (const categorySlug in categories) {
          const category = categories[categorySlug];
          
          if (sidebarCategoryList) {
              const categoryItem = document.createElement('li');
              categoryItem.className = 'category-item';
              
              // Determine icon
              const iconClass = categoryIcons[categorySlug.toLowerCase()] || 'fa-folder';
              
              categoryItem.innerHTML = `
              <a href="#" data-category="${categorySlug}" aria-current="${currentCategory === categorySlug ? 'page' : 'false'}">
                  <i class="fas ${iconClass}" aria-hidden="true"></i> ${category.name}
              </a>
              `;
              
              sidebarCategoryList.appendChild(categoryItem);
          }
      }
      
      // Add event listeners to sidebar category links
      const categoryLinks = document.querySelectorAll('.category-item a');
      categoryLinks.forEach(link => {
          link.addEventListener('click', function(e) {
              e.preventDefault();
              const category = this.getAttribute('data-category');
              
              // Update ARIA current attribute
              categoryLinks.forEach(l => l.setAttribute('aria-current', 'false'));
              this.setAttribute('aria-current', 'page');
              
              filterArticlesByCategory(category);
              
              // Update URL
              const url = new URL(window.location);
              if (category === 'all') {
                  url.searchParams.delete('category');
              } else {
                  url.searchParams.set('category', category);
              }
              url.searchParams.delete('tag'); // Remove tag filter when changing category
              window.history.pushState({}, '', url);
              
              // Log category filter event
              logEvent(analytics, 'select_content', {
                  content_type: 'category',
                  content_id: category
              });
          });
      });
      
      // Add category filters at top of content area
      categoryFilters.innerHTML = `
      <button class="category-filter ${currentCategory === 'all' ? 'active' : ''}" 
          data-category="all" aria-pressed="${currentCategory === 'all' ? 'true' : 'false'}">
          Alle
      </button>
      `;
      
      // Sort categories alphabetically
      const sortedCategories = Object.entries(categories)
          .sort((a, b) => a[1].name.localeCompare(b[1].name));
      
      // Add top categories to filters (up to 8)
      sortedCategories.slice(0, 8).forEach(([slug, category]) => {
          categoryFilters.innerHTML += `
          <button class="category-filter ${currentCategory === slug ? 'active' : ''}" 
              data-category="${slug}" aria-pressed="${currentCategory === slug ? 'true' : 'false'}">
              ${category.name}
          </button>
          `;
      });
      
      // Add event listeners to category filters
      const filters = document.querySelectorAll('.category-filter');
      filters.forEach(filter => {
          filter.addEventListener('click', function() {
              const category = this.getAttribute('data-category');
              
              filterArticlesByCategory(category);
              
              // Update active state
              filters.forEach(f => {
                  f.classList.remove('active');
                  f.setAttribute('aria-pressed', 'false');
              });
              this.classList.add('active');
              this.setAttribute('aria-pressed', 'true');
              
              // Update URL
              const url = new URL(window.location);
              if (category === 'all') {
                  url.searchParams.delete('category');
              } else {
                  url.searchParams.set('category', category);
              }
              url.searchParams.delete('tag'); // Remove tag filter when changing category
              window.history.pushState({}, '', url);
              
              // Log category filter event
              logEvent(analytics, 'select_content', {
                  content_type: 'category',
                  content_id: category
              });
          });
      });
  }
  
  // Update tag widgets in sidebar and content area
  function updateTagWidgets() {
      // Skip if no tags loaded
      if (!tags || Object.keys(tags).length === 0) return;
      
      // Sort tags by count (if available) or name
      const sortedTags = Object.entries(tags)
          .sort((a, b) => {
              if (a[1].count && b[1].count) {
                  return b[1].count - a[1].count; // Sort by count descending
              }
              return a[1].name.localeCompare(b[1].name); // Sort by name
          });
      
      // Add top tags to popular tags widget
      popularTags.innerHTML = '';
      
      sortedTags.slice(0, 12).forEach(([slug, tag]) => {
          const tagItem = document.createElement('div');
          tagItem.className = 'tag-item';
          tagItem.setAttribute('data-tag', slug);
          tagItem.setAttribute('role', 'button');
          tagItem.setAttribute('tabindex', '0');
          tagItem.setAttribute('aria-pressed', currentTag === slug ? 'true' : 'false');
          
          // Add count badge if available
          const countBadge = tag.count ? `<span class="tag-count">${tag.count}</span>` : '';
          
          tagItem.innerHTML = `${tag.name} ${countBadge}`;
          popularTags.appendChild(tagItem);
      });
      
      // Add event listeners to tag items
      const tagItems = document.querySelectorAll('.tag-item');
      tagItems.forEach(item => {
          // Mouse click
          item.addEventListener('click', function() {
              const tag = this.getAttribute('data-tag');
              filterArticlesByTag(tag);
              
              // Update ARIA state
              tagItems.forEach(t => t.setAttribute('aria-pressed', 'false'));
              this.setAttribute('aria-pressed', 'true');
              
              // Update URL
              const url = new URL(window.location);
              url.searchParams.set('tag', tag);
              window.history.pushState({}, '', url);
              
              // Log tag filter event
              logEvent(analytics, 'select_content', {
                  content_type: 'tag',
                  content_id: tag
              });
          });
          
          // Keyboard accessibility
          item.addEventListener('keydown', function(e) {
              if (e.key === 'Enter' || e.key === ' ') {
                  e.preventDefault();
                  this.click();
              }
          });
      });
  }
  
  // Filter articles by category with caching
  function filterArticlesByCategory(category) {
      currentCategory = category;
      currentTag = null; // Reset tag filter when changing category
      currentPage = 1; // Reset to first page
      
      if (category === 'all') {
          filteredArticles = [...allArticles];
          pageSubtitle.textContent = 'Laatste Nieuws uit Nederland in 10 Talen';
      } else {
          // Use cached results if available
          if (categoryCache[category]) {
              filteredArticles = categoryCache[category];
          } else {
              // Find the category name for the subtitle
              const categoryName = categories[category]?.name || category;
              pageSubtitle.textContent = categoryName;
              
              // Filter articles and cache the result
              filteredArticles = allArticles.filter(article => {
                  if (!article.categories) return false;
                  return article.categories.includes(categoryName);
              });
              
              // Store in cache
              categoryCache[category] = filteredArticles;
          }
          
          // Update the page subtitle
          const categoryName = categories[category]?.name || category;
          pageSubtitle.textContent = categoryName;
      }
      
      // Apply search filter if active
      if (searchQuery) {
          applySearchFilter();
      } else {
          displayArticles();
      }
  }
  
  // Filter articles by tag
  function filterArticlesByTag(tagSlug) {
      currentTag = tagSlug;
      currentPage = 1; // Reset to first page
      
      // Find the tag name for the subtitle
      const tagName = tags[tagSlug]?.name || tagSlug;
      pageSubtitle.textContent = `Tag: ${tagName}`;
      
      filteredArticles = allArticles.filter(article => {
          if (!article.tags) return false;
          return article.tags.includes(tagName);
      });
      
      // Update category filters to show "all" as active
      const categoryFilterElements = document.querySelectorAll('.category-filter');
      categoryFilterElements.forEach(filter => {
          filter.classList.remove('active');
          filter.setAttribute('aria-pressed', 'false');
          if (filter.getAttribute('data-category') === 'all') {
              filter.classList.add('active');
              filter.setAttribute('aria-pressed', 'true');
          }
      });
      
      displayArticles();
  }
  
  // Apply search filter to articles
  function applySearchFilter() {
      const query = searchQuery.toLowerCase();
      
      if (!query) {
          // If search is cleared, reset to category filter
          filterArticlesByCategory(currentCategory);
          return;
      }
      
      // Start with the current category filter
      let baseArticles = allArticles;
      if (currentCategory !== 'all') {
          // Use cached results if available
          if (categoryCache[currentCategory]) {
              baseArticles = categoryCache[currentCategory];
          } else {
              const categoryName = categories[currentCategory]?.name || currentCategory;
              baseArticles = allArticles.filter(article => {
                  if (!article.categories) return false;
                  return article.categories.includes(categoryName);
              });
              // Store in cache
              categoryCache[currentCategory] = baseArticles;
          }
      }
      
      // Then apply search filter
      filteredArticles = baseArticles.filter(article => {
          const title = article.title?.toLowerCase() || '';
          const content = article.content?.toLowerCase() || '';
          const preview = article.preview?.toLowerCase() || '';
          
          // Check SEO keywords if available
          let keywordsMatch = false;
          if (article.seo && article.seo.keywords) {
              keywordsMatch = article.seo.keywords.some(keyword => 
                  keyword.toLowerCase().includes(query)
              );
          }
          
          // Check categories and tags
          let categoriesMatch = false;
          if (article.categories) {
              categoriesMatch = article.categories.some(category => 
                  category.toLowerCase().includes(query)
              );
          }
          
          let tagsMatch = false;
          if (article.tags) {
              tagsMatch = article.tags.some(tag => 
                  tag.toLowerCase().includes(query)
              );
          }
          
          return title.includes(query) || 
                 content.includes(query) || 
                 preview.includes(query) ||
                 keywordsMatch ||
                 categoriesMatch ||
                 tagsMatch;
      });
      
      // Update page subtitle
      pageSubtitle.textContent = `Zoekresultaten voor: "${searchQuery}"`;
      displayArticles();
      
      // Log search event
      logEvent(analytics, 'search', {
          search_term: searchQuery
      });
  }
  
  // Handle pagination
  function setupPagination() {
      const totalPages = Math.ceil(filteredArticles.length / articlesPerPage);
      pagination.innerHTML = '';
      
      // Only show pagination if we have more than one page
      if (totalPages <= 1) return;
      
      // Previous button
      if (currentPage > 1) {
          const prevBtn = document.createElement('button');
          prevBtn.className = 'pagination-btn';
          prevBtn.innerHTML = '<i class="fas fa-chevron-left" aria-hidden="true"></i> Vorige';
          prevBtn.setAttribute('aria-label', 'Ga naar vorige pagina');
          prevBtn.addEventListener('click', () => {
              currentPage--;
              displayArticles();
              window.scrollTo({ top: 0, behavior: 'smooth' });
              
              // Log pagination event
              logEvent(analytics, 'page_change', {
                  page_number: currentPage
              });
          });
          pagination.appendChild(prevBtn);
      }
      
      // Page numbers
      const startPage = Math.max(1, currentPage - 2);
      const endPage = Math.min(totalPages, currentPage + 2);
      
      for (let i = startPage; i <= endPage; i++) {
          const pageBtn = document.createElement('button');
          pageBtn.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
          pageBtn.textContent = i;
          pageBtn.setAttribute('aria-label', `Ga naar pagina ${i}`);
          pageBtn.setAttribute('aria-current', i === currentPage ? 'page' : 'false');
          
          pageBtn.addEventListener('click', () => {
              currentPage = i;
              displayArticles();
              window.scrollTo({ top: 0, behavior: 'smooth' });
              
              // Log pagination event
              logEvent(analytics, 'page_change', {
                  page_number: currentPage
              });
          });
          
          pagination.appendChild(pageBtn);
      }
      
      // Next button
      if (currentPage < totalPages) {
          const nextBtn = document.createElement('button');
          nextBtn.className = 'pagination-btn';
          nextBtn.innerHTML = 'Volgende <i class="fas fa-chevron-right" aria-hidden="true"></i>';
          nextBtn.setAttribute('aria-label', 'Ga naar volgende pagina');
          
          nextBtn.addEventListener('click', () => {
              currentPage++;
              displayArticles();
              window.scrollTo({ top: 0, behavior: 'smooth' });
              
              // Log pagination event
              logEvent(analytics, 'page_change', {
                  page_number: currentPage
              });
          });
          
          pagination.appendChild(nextBtn);
      }
  }
  
  // Display articles based on current filters and pagination
  function displayArticles() {
      console.log(`Displaying ${filteredArticles.length} filtered articles`);
      
      // Get the articles for the current page
      const startIndex = (currentPage - 1) * articlesPerPage;
      const endIndex = startIndex + articlesPerPage;
      const articlesToShow = filteredArticles.slice(startIndex, endIndex);
      
      articlesContainer.innerHTML = '';
      
      // Show message if no articles match filters
      if (articlesToShow.length === 0) {
          articlesContainer.innerHTML = `
          <div class="article" tabindex="0" role="article">
              <h2>Geen resultaten gevonden</h2>
              <p>Er zijn geen artikelen die voldoen aan de huidige filters.</p>
              <button class="btn btn-primary" id="resetFilters">
                  Filters resetten
              </button>
          </div>
          `;
          
          document.getElementById('resetFilters')?.addEventListener('click', () => {
              // Reset all filters
              currentCategory = 'all';
              currentTag = null;
              searchQuery = '';
              searchInput.value = '';
              
              // Reset URL parameters
              const url = new URL(window.location);
              url.search = '';
              window.history.pushState({}, '', url);
              
              // Reset filters and display all articles
              filteredArticles = [...allArticles];
              pageSubtitle.textContent = 'Laatste Nieuws uit Nederland';
              displayArticles();
              
              // Log reset filters event
              logEvent(analytics, 'reset_filters');
          });
          
          return;
      }
      
      // Add articles to the page
      articlesToShow.forEach((article, index) => {
          const articleDiv = document.createElement('div');
          articleDiv.className = 'article' + (index === 0 && currentPage === 1 ? ' featured-article' : '');
          articleDiv.setAttribute('tabindex', '0');
          articleDiv.setAttribute('role', 'article');
          articleDiv.setAttribute('aria-labelledby', `article-title-${index}`);
          
          // Clean and truncate the article title
          let cleanTitle = cleanArticleTitle(article.title);
          
          // Truncate very long titles (over 100 characters)
          if (cleanTitle.length > 100) {
              cleanTitle = cleanTitle.substring(0, 97) + '...';
          }
          
          // Add featured badge to first article
          const featuredBadge = (index === 0 && currentPage === 1) ? 
              '<div class="featured-badge">Uitgelicht</div>' : '';
          
          // Image HTML
          const imageHtml = article.image_url ? 
              `<div class="article-image-container">
                  <img src="${article.image_url}" 
                      alt="${cleanTitle}" 
                      class="article-image"
                      loading="${index === 0 ? 'eager' : 'lazy'}"
                      width="600" height="400">
              </div>` : '';
          
          // Format date
          const displayDate = article.displayDate || formatDutchDate(article.timestamp);
          
          // Calculate reading time
          const readingTime = estimateReadingTime(article.content);
          
          // Categories HTML
          let categoriesHtml = '';
          if (article.categories && article.categories.length > 0) {
              categoriesHtml = `
              <div class="article-categories">
                  ${article.categories.map(category => 
                      `<button class="article-category" type="button">${category}</button>`
                  ).join('')}
              </div>
              `;
          }
          
          // Tags HTML
          let tagsHtml = '';
          if (article.tags && article.tags.length > 0) {
              tagsHtml = `
              <div class="article-tags">
                  ${article.tags.map(tag => 
                      `<button class="article-tag" type="button">${tag}</button>`
                  ).join('')}
              </div>
              `;
          }
          
          // Generate slug from cleaned title if not available
          const articleSlug = article.slug || createSafeSlug(cleanTitle);
          
          // Clean up the preview text as well
          let cleanPreview = article.preview || '';
          if (!cleanPreview && article.content) {
              cleanPreview = typeof article.content === 'string' ? article.content.substring(0, 200) + '...' : '';
          }
          
          // Also look for AI explanations in preview
          for (const pattern of ['. Let op dat', '. Als AI', '. Ik wil']) {
              const patternIndex = cleanPreview.indexOf(pattern);
              if (patternIndex > 0) {
                  cleanPreview = cleanPreview.substring(0, patternIndex + 1);
                  break;
              }
          }
          
          // Article meta information
          const metaInfo = `
          <div class="article-meta">
              <div class="article-date">
                  <i class="far fa-calendar-alt" aria-hidden="true"></i> ${displayDate}
              </div>
              <div class="reading-time">
                  <i class="far fa-clock" aria-hidden="true"></i> ${readingTime} leestijd
              </div>
          </div>
          `;
          
          // Share buttons
          const shareButtons = `
          <div class="share-buttons">
              <a href="https://www.facebook.com/sharer/sharer.php?u=${safeEncodeURI(`https://hetnieuws.app/article/${articleSlug}`)}" 
                  target="_blank" rel="noopener noreferrer nofollow" class="share-btn facebook-share" aria-label="Deel op Facebook">
                  <i class="fab fa-facebook-f" aria-hidden="true"></i> Delen
              </a>
              <a href="https://twitter.com/intent/tweet?text=${safeEncodeURI(cleanTitle)}&url=${safeEncodeURI(`https://hetnieuws.app/article/${articleSlug}`)}" 
                  target="_blank" rel="noopener noreferrer nofollow" class="share-btn twitter-share" aria-label="Deel op Twitter">
                  <i class="fab fa-twitter" aria-hidden="true"></i> Tweet
              </a>
              <a href="https://wa.me/?text=${safeEncodeURI(`${cleanTitle} https://hetnieuws.app/article/${articleSlug}`)}" 
                  target="_blank" rel="noopener noreferrer nofollow" class="share-btn whatsapp-share" aria-label="Deel via WhatsApp">
                  <i class="fab fa-whatsapp" aria-hidden="true"></i> WhatsApp
              </a>
              <a href="https://www.linkedin.com/shareArticle?mini=true&url=${safeEncodeURI(`https://hetnieuws.app/article/${articleSlug}`)}&title=${safeEncodeURI(cleanTitle)}" 
                  target="_blank" rel="noopener noreferrer nofollow" class="share-btn linkedin-share" aria-label="Deel op LinkedIn">
                  <i class="fab fa-linkedin-in" aria-hidden="true"></i> LinkedIn
              </a>
              <a href="mailto:?subject=${safeEncodeURI(cleanTitle)}&body=${safeEncodeURI(`${cleanTitle}\n\nhttps://hetnieuws.app/article/${articleSlug}`)}" 
                  class="share-btn email-share" aria-label="Deel via e-mail">
                  <i class="far fa-envelope" aria-hidden="true"></i> E-mail
              </a>
          </div>
          `;
          
          // Structured data for this article
          const articleSchema = {
              "@context": "https://schema.org",
              "@type": "NewsArticle",
              "headline": cleanTitle,
              "description": cleanPreview,
              "image": article.image_url ? [article.image_url] : [],
              "datePublished": article.timestamp ? new Date(article.timestamp * 1000).toISOString() : new Date().toISOString(),
              "dateModified": article.updated ? new Date(article.updated * 1000).toISOString() : new Date().toISOString(),
                    "author": {
                        "@type": "Organization",
                        "name": "HetNieuws.app",
                        "url": "https://hetnieuws.app"
                    },
                    "publisher": {
                        "@type": "Organization",
                        "name": "HetNieuws.app",
                        "logo": {
                            "@type": "ImageObject",
                            "url": "https://hetnieuws.app/hetnieuws-app-logo.png"
                        }
                    },
                    "mainEntityOfPage": {
                        "@type": "WebPage",
                        "@id": `https://hetnieuws.app/article/${articleSlug}`
                    }
                };
                
                const schemaScript = document.createElement('script');
                schemaScript.type = 'application/ld+json';
                schemaScript.textContent = JSON.stringify(articleSchema);
                
                articleDiv.innerHTML = `
                ${featuredBadge}
                ${imageHtml}
                <div class="article-content">
                    ${categoriesHtml}
                    <h2 id="article-title-${index}"><a href="/article/${articleSlug}" class="article-title-link">${cleanTitle}</a></h2>
                    ${metaInfo}
                    <h3>${cleanPreview}</h3>
                    <div class="article-actions">
                        <a href="/article/${articleSlug}" class="read-more">Lees meer</a>
                        ${tagsHtml}
                    </div>
                    ${shareButtons}
                </div>
                `;
                
                // Append the schema script to the article
                articleDiv.appendChild(schemaScript);
                articlesContainer.appendChild(articleDiv);
            });
            
            setupPagination();
            
            // Make categories and tags clickable
            const categoryElements = document.querySelectorAll('.article-category');
            categoryElements.forEach(element => {
                element.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevent article click
                    const categoryName = this.textContent;
                    
                    // Find the category slug from the name
                    let categorySlug = 'all';
                    for (const slug in categories) {
                        if (categories[slug].name === categoryName) {
                            categorySlug = slug;
                            break;
                        }
                    }
                    
                    filterArticlesByCategory(categorySlug);
                    
                    // Update URL
                    const url = new URL(window.location);
                    url.searchParams.set('category', categorySlug);
                    url.searchParams.delete('tag'); // Remove tag filter
                    window.history.pushState({}, '', url);
                    
                    // Log category selection event
                    logEvent(analytics, 'select_content', {
                        content_type: 'category',
                        content_id: categorySlug
                    });
                });
            });
            
            const tagElements = document.querySelectorAll('.article-tag');
            tagElements.forEach(element => {
                element.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevent article click
                    const tagName = this.textContent;
                    
                    // Find the tag slug from the name
                    let tagSlug = '';
                    for (const slug in tags) {
                        if (tags[slug].name === tagName) {
                            tagSlug = slug;
                            break;
                        }
                    }
                    
                    if (tagSlug) {
                        filterArticlesByTag(tagSlug);
                        
                        // Update URL
                        const url = new URL(window.location);
                        url.searchParams.set('tag', tagSlug);
                        window.history.pushState({}, '', url);
                        
                        // Log tag selection event
                        logEvent(analytics, 'select_content', {
                            content_type: 'tag',
                            content_id: tagSlug
                        });
                    }
                });
            });
            
            // Make article cards clickable
            const articleCards = document.querySelectorAll('.article');
            articleCards.forEach((card, index) => {
                const article = articlesToShow[index];
                if (article) {
                    card.addEventListener('click', function(e) {
                        // Don't trigger if clicking on a link or button
                        if (e.target.tagName === 'A' || e.target.tagName === 'BUTTON' || 
                            e.target.closest('a') || e.target.closest('button') ||
                            e.target.classList.contains('article-tag') || 
                            e.target.classList.contains('article-category')) {
                            return;
                        }
                        
                        // Clean title for slug generation
                        const cleanTitle = cleanArticleTitle(article.title);
                        
                        // Generate slug from cleaned title
                        const articleSlug = article.slug || createSafeSlug(cleanTitle);
                        
                        // Log article click event
                        logEvent(analytics, 'select_content', {
                            content_type: 'article',
                            content_id: articleSlug
                        });
                        
                        window.location.href = `/article/${articleSlug}`;
                    });
                    
                    // Add keyboard accessibility
                    card.addEventListener('keydown', function(e) {
                        if (e.key === 'Enter') {
                            // Find the article title link and click it
                            const titleLink = this.querySelector('.article-title-link');
                            if (titleLink) {
                                titleLink.click();
                            }
                        }
                    });
                }
            });
            
            // Add lazy loading observer for images
            if ('IntersectionObserver' in window) {
                const imageObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const image = entry.target;
                            if (image.dataset.src) {
                                image.src = image.dataset.src;
                                image.removeAttribute('data-src');
                            }
                            imageObserver.unobserve(image);
                        }
                    });
                });
                
                const lazyImages = document.querySelectorAll('img[loading="lazy"]');
                lazyImages.forEach(img => {
                    imageObserver.observe(img);
                });
            }
        }
        
        // Initialize recent posts sidebar
        function updateRecentPosts() {
  if (!recentPostsList || allArticles.length === 0) return;
  console.log("Updating recent posts sidebar");
  const recentArticles = allArticles.slice(0, 5);
  recentPostsList.innerHTML = '';
  recentArticles.forEach((article, index) => {
    // Clean and truncate title for recent posts
    let cleanTitle = cleanArticleTitle(article.title);
    // Ensure titles in sidebar are short
    if (cleanTitle.length > 70) {
      cleanTitle = cleanTitle.substring(0, 67) + '...';
    }
    // Generate slug from title if not available
    const articleSlug = article.slug || createSafeSlug(cleanTitle);
    const li = document.createElement('li');
    li.className = 'recent-post';
    li.innerHTML = `
      ${article.image_url ? 
      `<img src="${article.image_url}" alt="${cleanTitle}" loading="lazy" width="80" height="80">` : 
      ''}
      <div class="recent-post-content">
        <h3><a href="/article/${articleSlug}" id="recent-post-${index}">${cleanTitle}</a></h3>
            </div>
    `;
    recentPostsList.appendChild(li);
  });
            
            // Make recent posts clickable
            const recentPosts = document.querySelectorAll('.recent-post');
            recentPosts.forEach((post, index) => {
                post.addEventListener('click', function(e) {
                    // Don't trigger if clicking on a link
                    if (e.target.tagName === 'A' || e.target.closest('a')) {
                        return;
                    }
                    
                    // Find and click the link
                    const link = this.querySelector('a');
                    if (link) {
                        link.click();
                    }
                });
                
                // Add keyboard accessibility
                post.setAttribute('tabindex', '0');
                post.setAttribute('role', 'article');
                post.setAttribute('aria-labelledby', `recent-post-${index}`);
                
                post.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        const link = this.querySelector('a');
                        if (link) {
                            link.click();
                        }
                    }
                });
            });
        }
        
        // Initialize search functionality
        function initializeSearch() {
            if (searchForm) {
                searchForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    searchQuery = searchInput.value;
                    
                    // Update URL
                    const url = new URL(window.location);
                    if (searchQuery) {
                        url.searchParams.set('query', searchQuery);
                    } else {
                        url.searchParams.delete('query');
                    }
                    window.history.pushState({}, '', url);
                    
                    applySearchFilter();
                });
            }
            
            // Real-time search with debounce
            if (searchInput) {
                let debounceTimeout;
                searchInput.addEventListener('input', function() {
                    clearTimeout(debounceTimeout);
                    
                    debounceTimeout = setTimeout(() => {
                        searchQuery = this.value;
                        
                        // Only update for non-empty searches or when clearing search
                        if (searchQuery.length >= 3 || searchQuery.length === 0) {
                            // Don't update URL during typing
                            applySearchFilter();
                        }
                    }, 500);
                });
            }
        }
        
        // Newsletter form handling
        function initializeNewsletterForm() {
            const newsletterForm = document.getElementById('newsletterForm');
            if (newsletterForm) {
                newsletterForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const email = this.querySelector('input[type="email"]').value;
                    
                    // In a real implementation, you would send this to your backend
                    // and handle validation, confirmation emails, etc.
                    
                    // For now, we'll just show a simple alert
                    alert(`Bedankt voor je aanmelding met: ${email}`);
                    this.reset();
                    
                    // Log newsletter subscription event
                    logEvent(analytics, 'sign_up', {
                        method: 'newsletter'
                    });
                });
            }
        }
        
        // Add advanced article tracking
        function initializeArticleTracking() {
            // Track article views
            if (articlesContainer) {
                // Use Intersection Observer to track when articles are viewed
                if ('IntersectionObserver' in window) {
                    const articleObserver = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                const article = entry.target;
                                const articleId = article.getAttribute('aria-labelledby');
                                const articleTitle = document.getElementById(articleId)?.textContent;
                                
                                if (articleTitle && !article.dataset.viewed) {
                                    // Mark as viewed to avoid duplicate events
                                    article.dataset.viewed = 'true';
                                    
                                    // Log article view event
                                    logEvent(analytics, 'view_item', {
                                        content_type: 'article',
                                        content_id: articleId,
                                        content_name: articleTitle
                                    });
                                }
                            }
                        });
                    }, {
                        threshold: 0.5 // Track when at least 50% of the article is visible
                    });
                    
                    // Observe all articles
                    const articles = document.querySelectorAll('.article');
                    articles.forEach(article => {
                        articleObserver.observe(article);
                    });
                }
            }
        }
        
        // Main function to load articles
        async function loadArticles() {
            try {
                // Show loading indicator
                if (loading) loading.style.display = 'block';
                console.log("Loading articles...");
                
                // Load categories and tags first
                await loadCategoriesAndTags();
                
                // Load all articles
                const articlesRef = ref(db, 'articles');
                
                // Use once for initial load
                const snapshot = await get(articlesRef);
                
                if (snapshot.exists()) {
                    console.log("Articles data retrieved from Firebase");
                    const articlesData = snapshot.val();
                    
                    allArticles = Object.values(articlesData)
                        .sort((a, b) => {
                            // Check if timestamp exists
                            if (!a.timestamp && !b.timestamp) return 0;
                            if (!a.timestamp) return 1;
                            if (!b.timestamp) return -1;
                            
                            // Convert to absolute values if they're negative
                            const timestampA = Math.abs(a.timestamp);
                            const timestampB = Math.abs(b.timestamp);
                            
                            // Sort in descending order (newest first)
                            return timestampB - timestampA;
                        });
                        
                    console.log(`Loaded ${allArticles.length} articles`);
                    
                    // Process articles for display
                    allArticles = allArticles.map(article => {
                        // Add displayDate if not already present
                        if (!article.displayDate) {
                            article.displayDate = formatDutchDate(article.timestamp);
                        }
                        
                        // Generate slug if not present
                        if (!article.slug) {
                            const cleanTitle = cleanArticleTitle(article.title);
                            article.slug = createSafeSlug(cleanTitle);
                        }
                        
                        return article;
                    });
                    
                    // Apply initial filters from URL parameters
                    if (currentCategory !== 'all') {
                        filterArticlesByCategory(currentCategory);
                    } else if (currentTag) {
                        filterArticlesByTag(currentTag);
                    } else if (searchQuery) {
                        filteredArticles = [...allArticles];
                        applySearchFilter();
                    } else {
                        filteredArticles = [...allArticles];
                        displayArticles();
                    }
                    
                    // Update recent posts sidebar
                    updateRecentPosts();
                    
                    // Setup article tracking
                    initializeArticleTracking();
                    
                    // Listen for real-time updates to articles
                    onValue(articlesRef, (snapshot) => {
                        if (snapshot.exists()) {
                            const newArticlesData = snapshot.val();
                            const newArticles = Object.values(newArticlesData)
                                .sort((a, b) => {
                                    // Sort by timestamp descending
                                    if (!a.timestamp && !b.timestamp) return 0;
                                    if (!a.timestamp) return 1;
                                    if (!b.timestamp) return -1;
                                    return Math.abs(b.timestamp) - Math.abs(a.timestamp);
                                });
                                
                            // Check if articles have changed
                            if (JSON.stringify(newArticles) !== JSON.stringify(allArticles)) {
                                console.log("Articles updated in real-time");
                                
                                // Process articles for display
                                allArticles = newArticles.map(article => {
                                    // Add displayDate if not already present
                                    if (!article.displayDate) {
                                        article.displayDate = formatDutchDate(article.timestamp);
                                    }
                                    
                                    // Generate slug if not present
                                    if (!article.slug) {
                                        const cleanTitle = cleanArticleTitle(article.title);
                                        article.slug = createSafeSlug(cleanTitle);
                                    }
                                    
                                    return article;
                                });
                                
                                // Clear category cache
                                categoryCache = {};
                                
                                // Reapply current filters
                                if (currentCategory !== 'all') {
                                    filterArticlesByCategory(currentCategory);
                                } else if (currentTag) {
                                    filterArticlesByTag(currentTag);
                                } else if (searchQuery) {
                                    filteredArticles = [...allArticles];
                                    applySearchFilter();
                                } else {
                                    filteredArticles = [...allArticles];
                                    displayArticles();
                                }
                                
                                // Update recent posts sidebar
                                updateRecentPosts();
                            }
                        }
                    });
                    
                } else {
                    console.log("No articles found in database");
                    articlesContainer.innerHTML = `
                    <div class="article" tabindex="0" role="article">
                        <h2>Geen artikelen gevonden</h2>
                        <p>Er zijn momenteel geen artikelen beschikbaar. Kom later terug voor het laatste nieuws.</p>
                    </div>`;
                }
                
                // Initialize search functionality
                initializeSearch();
                
                // Initialize newsletter form
                initializeNewsletterForm();
                
                // Initialize cookie consent
                initCookieConsent();
                
            } catch (error) {
                console.error('Error loading content:', error);
                articlesContainer.innerHTML = `
                <div class="article" tabindex="0" role="article">
                    <h2>Fout bij het laden</h2>
                    <p>Er is een fout opgetreden bij het laden van de artikelen: ${error.message}</p>
                    <button id="retryLoading" class="read-more">Opnieuw proberen</button>
                </div>`;
                
                // Add retry button functionality
                document.getElementById('retryLoading')?.addEventListener('click', () => {
                    loadArticles();
                });
                
                // Log error event
                logEvent(analytics, 'exception', {
                    description: `Error loading articles: ${error.message}`,
                    fatal: false
                });
                
            } finally {
                // Hide loading indicator
                if (loading) loading.style.display = 'none';
            }
        }
        
        // Load articles when the page loads
        window.addEventListener('DOMContentLoaded', function() {
            // Start loading articles
            loadArticles();
            
            // Setup offline/online detection
            window.addEventListener('online', () => {
                console.log('Back online, refreshing content...');
                // Reload content when coming back online
                loadArticles();
            });
            
            window.addEventListener('offline', () => {
                console.log('Offline mode detected');
                // Notify user they're offline
                const notification = document.createElement('div');
                notification.className = 'cookie-banner show';
                notification.innerHTML = `
                <div class="cookie-content">
                    <div class="cookie-text">
                        <p><i class="fas fa-wifi" style="color:red;"></i> Je bent offline. Sommige functies zijn mogelijk beperkt.</p>
                    </div>
                    <div class="cookie-buttons">
                        <button class="cookie-btn cookie-decline" id="closeOfflineNotice">Sluiten</button>
                    </div>
                </div>
                `;
                
                document.body.appendChild(notification);
                
                document.getElementById('closeOfflineNotice')?.addEventListener('click', () => {
                    notification.remove();
                });
            });
        });
        
        // Add performance monitoring
        window.addEventListener('load', () => {
            // Log performance metrics once page is fully loaded
            if ('performance' in window) {
                setTimeout(() => {
                    const perfData = window.performance.timing;
                    const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
                    const domLoadTime = perfData.domComplete - perfData.domLoading;
                    
                    console.log(`Page load time: ${pageLoadTime}ms, DOM load time: ${domLoadTime}ms`);
                    
                    // Log performance event
                    logEvent(analytics, 'page_performance', {
                        page_load_time: pageLoadTime,
                        dom_load_time: domLoadTime
                    });
                }, 0);
            }
        });
        
    } catch (error) {
        console.error("Error initializing Firebase:", error);
        document.getElementById('articles-container').innerHTML = `
        <div class="article" tabindex="0" role="article">
            <h2>Fout bij het initialiseren</h2>
            <p>Er is een fout opgetreden bij het initialiseren van het systeem: ${error.message}</p>
            <p>Vernieuw de pagina om het opnieuw te proberen of neem contact op met de beheerder als het probleem aanhoudt.</p>
        </div>`;
        
        document.getElementById('loading').style.display = 'none';
    }
    </script>
    <script>
// Simple dark mode toggle - to be used with force-light-mode style
document.addEventListener('DOMContentLoaded', function() {
  const darkModeToggle = document.getElementById('darkModeToggle');
  const forceLightMode = document.getElementById('force-light-mode');
  
  if (darkModeToggle) {
    darkModeToggle.addEventListener('click', function() {
      // Simply remove the force-light-mode style to enable dark mode
      if (forceLightMode) {
        if (forceLightMode.disabled) {
          forceLightMode.disabled = false;
          localStorage.setItem('mode', 'light');
          document.getElementById('darkModeIcon').className = 'fas fa-moon';
          document.getElementById('darkModeText').textContent = 'Donker';
        } else {
          forceLightMode.disabled = true;
          localStorage.setItem('mode', 'dark');
          document.getElementById('darkModeIcon').className = 'fas fa-sun';
          document.getElementById('darkModeText').textContent = 'Licht';
        }
      }
    });
  }
  
  // Check stored preference
  if (localStorage.getItem('mode') === 'dark') {
    forceLightMode.disabled = true;
    document.getElementById('darkModeIcon').className = 'fas fa-sun';
    document.getElementById('darkModeText').textContent = 'Licht';
  }
});
</script>
</body>
</html>